name: Fork Sync with Upstream

on:
  schedule:
    - cron: '*/6 * * * *'  # 6ë¶„ë§ˆë‹¤ ë™ê¸°í™”
  workflow_dispatch:        # ìˆ˜ë™ ì‹¤í–‰ë„ í—ˆìš©

permissions:
  contents: write

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout fork repository
        uses: actions/checkout@v4

      - name: Set Git config
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

      - name: Add upstream remote
        run: |
          git remote add upstream https://github.com/DONGSUKA/first_test.git
          git fetch upstream

      - name: Merge upstream/main into fork/main
        run: |
          git checkout main
          git merge upstream/main --allow-unrelated-histories --no-edit || true

          # ë³‘í•© ì¶©ëŒ ê°ì§€ ë° í•´ê²°
          if git ls-files -u | grep -q .; then
            echo "ğŸ”§ ì¶©ëŒ ë°œìƒ. README.mdë¥¼ upstream ë²„ì „ìœ¼ë¡œ ë®ì–´ì“°ê¸°"
            git checkout --theirs README.md
            git add README.md
            git commit -m "ğŸ¤– README ì¶©ëŒ ìë™ í•´ê²° (upstream ê¸°ì¤€)"
          fi

      - name: Push changes to forked repo
        run: |
          git push origin main
